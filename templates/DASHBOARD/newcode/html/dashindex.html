{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %} Chat Admin Dashboard {% endblock %}</title>
  <link rel="icon" type="image/x-icon" href="{% static 'images/bbbm.ico' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- CSS (Django static) -->
  <link href="{% static 'DASHBOARD/CSS/indexx.css' %}" rel="stylesheet">
  <style>
    :root {
  --sidebar-width: 250px;
  --sidebar-collapsed-width: 70px;
  --primary-bg: #0b1e3b;
  --secondary-bg: #1c2f4a;
  --text-light: #b8c7ce;
  --text-dark: #212529;
  --white: #ffffff;
  --dark: #121212;
  --light: #f8f9fc;
  --accent: #4eac6d;
  --danger: #fa5252;
  --transition: all 0.3s ease;
  --glow: 0 0 8px rgba(78, 172, 109, 0.5);
}

body {
  font-family: 'Segoe UI', sans-serif;
  background-color: var(--light);
  color: var(--text-dark);
  transition: var(--transition);
  margin: 0;
  padding: 0;
}

body.dark-mode {
  background-color: var(--dark);
  color: var(--white);
}

/* Sidebar Styles */
.sidebar {
  width: var(--sidebar-width);
  height: 100vh;
  background-color: var(--primary-bg);
  position: fixed;
  color: var(--white);
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
  display: flex;
  flex-direction: column;
  transition: var(--transition);
  z-index: 1000;
}

.sidebar.collapsed {
  width: var(--sidebar-collapsed-width);
}

.sidebar.collapsed .nav-text,
.sidebar.collapsed h4,
.sidebar.collapsed .user-section h5,
.sidebar.collapsed .user-section p,
.sidebar.collapsed .copyright,
.sidebar.collapsed .toggle-arrow {
  display: none;
}

.sidebar.collapsed .nav-link {
  text-align: center;
  padding: 12px 5px;
  position: relative;
}

.sidebar.collapsed .nav-link i {
  font-size: 1.2rem;
  margin-right: 0;
}

.sidebar.collapsed .sub-menu .nav-link {
  padding-left: 5px;
}

.sidebar.collapsed .nav-link:hover .nav-tooltip {
  display: block;
}

.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-thumb {
  background-color: #888;
  border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
  background: #555;
}

.sidebar h4 {
  padding: 20px;
  font-weight: bold;
  position: sticky;
  top: 0;
  background-color: var(--primary-bg);
  z-index: 10;
  margin: 0;
  text-align: center;
}

.sidebar .nav-link {
  color: var(--text-light);
  padding: 12px 20px;
  transition: var(--transition);
  display: flex;
  align-items: center;
  text-decoration: none;
  position: relative;
}

.sidebar .nav-link i {
  margin-right: 10px;
  font-size: 1rem;
}

.sidebar .nav-link.active,
.sidebar .nav-link:hover {
  background-color: var(--secondary-bg);
  color: var(--white);
}

.sidebar .nav-link[aria-expanded="true"] {
  background-color: var(--secondary-bg);
  color: var(--white);
}

.sidebar .sub-menu .nav-link {
  padding-left: 40px;
  background-color: #0a1729;
}

.sidebar .sub-menu .nav-link:hover {
  background-color: #15253d;
}

.nav-tooltip {
  display: none;
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  background-color: var(--secondary-bg);
  color: var(--white);
  padding: 5px 10px;
  border-radius: 4px;
  white-space: nowrap;
  z-index: 1000;
  margin-left: 10px;
  font-size: 0.9rem;
}

.sidebar.collapsed .sub-menu {
  position: absolute;
  left: 100%;
  top: 0;
  width: 200px;
  background-color: var(--primary-bg);
  border-radius: 0 4px 4px 0;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
  display: none;
}

.sidebar.collapsed .nav-link:hover .sub-menu {
  display: block;
}

/* User Section */
.user-section {
  margin-top: auto;
  padding: 20px;
  background-color: var(--secondary-bg);
  border-top: 1px solid #2a3e5d;
}

.user-section h5 {
  color: var(--white);
  margin-bottom: 5px;
  font-size: 1rem;
}

.user-section p {
  color: var(--text-light);
  font-size: 0.8rem;
  margin-bottom: 15px;
}

.logout-btn {
  background-color: var(--danger);
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 5px;
  font-weight: bold;
  width: 100%;
  transition: var(--transition);
  cursor: pointer;
}

.logout-btn:hover {
  background-color: #e03131;
}

.copyright {
  color: var(--text-light);
  font-size: 0.7rem;
  text-align: center;
  padding: 15px 0;
  border-top: 1px solid #2a3e5d;
}

/* Main Content */
.main-content {
  margin-left: var(--sidebar-width);
  padding: 20px;
  transition: var(--transition);
  min-height: 100vh;
}

body.dark-mode .main-content {
  background-color: var(--dark);
}

.sidebar.collapsed ~ .main-content {
  margin-left: var(--sidebar-collapsed-width);
}

/* Header Styles */
.header-bar {
  background-color: var(--white);
  padding: 0.75rem 1.5rem;
  position: sticky;
  top: 0;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  margin-bottom: 1.5rem;
  transition: var(--transition);
}

body.dark-mode .header-bar {
  background-color: #1e1e1e;
  color: var(--white);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.header-controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.header-control-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.header-icon-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: transparent;
  border: none;
  color: var(--text-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
  position: relative;
  cursor: pointer;
}

body.dark-mode .header-icon-btn {
  color: var(--text-light);
}

.header-icon-btn:hover {
  background-color: darkcyan;
  color: var(--text-dark);
}

body.dark-mode .header-icon-btn:hover {
  background-color: #2a2a2a;
  color: var(--white);
}

.header-icon-btn i {
  font-size: 1.1rem;
}

.header-search {
  flex: 1;
  max-width: 400px;
  position: relative;
}

.header-search i {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #adb5bd;
  font-size: 0.9rem;
}

.header-icon-btn span {
  margin-top: 50px;
}

/* Search */
.search-highlight {
  background-color: #FFEB3B;
  color: #000;
  padding: 0 2px;
  border-radius: 2px;
}

.search-no-results {
  text-align: center;
  padding: 20px;
  color: #666;
  font-size: 1.2rem;
  display: none;
}

.search-btn {
  background: transparent;
  border: none;
  color: #adb5bd;
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
}

body.dark-mode .search-btn {
  color: #6c757d;
}

.search-btn:hover {
  color: var(--accent);
}

.search-input {
  width: 100%;
  padding: 0.5rem 1rem 0.5rem 2.25rem;
  border-radius: 20px;
  border: 1px solid #e9ecef;
  background-color: #f8f9fa;
  transition: var(--transition);
  font-size: 0.9rem;
}

body.dark-mode .search-input {
  background-color: #2a2a2a;
  border-color: #444;
  color: var(--white);
}

.search-input:focus {
  outline: none;
  border-color: #d0d7de;
  background-color: var(--white);
  box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
}

body.dark-mode .search-input:focus {
  background-color: #333;
  border-color: #555;
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  overflow: hidden;
  margin: 0 0.5rem;
  cursor: pointer;
}

.user-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.notification-btn {
  position: relative;
}

.notification-badge {
  position: absolute;
  bottom: 20px;
  right: -2px;
  background-color: var(--danger);
  color: white;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  font-size: 0.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

/* Settings Panel - Professional Design */
.settings-panel {
  position: fixed;
  top: 0;
  right: -400px;
  width: 400px;
  height: 100vh;
  background-color: var(--white);
  box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
  transition: var(--transition);
  z-index: 1050;
  padding: 20px;
  overflow-y: auto;
}

body.dark-mode .settings-panel {
  background-color: #2a2a2a;
  box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
}

.settings-panel.open {
  right: 0;
}

.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #e9ecef;
}

body.dark-mode .settings-header {
  border-bottom-color: #444;
}

.settings-title {
  font-size: 1.5rem;
  font-weight: 600;
}

.close-settings {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-dark);
}

body.dark-mode .close-settings {
  color: var(--text-light);
}

.settings-section {
  margin-bottom: 25px;
}

.settings-section-title {
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 15px;
  color: var(--accent);
}

.theme-options {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.theme-option {
  flex: 1;
  text-align: center;
  cursor: pointer;
  padding: 10px;
  border-radius: 8px;
  border: 2px solid transparent;
  transition: var(--transition);
}

.theme-option:hover {
  border-color: var(--accent);
}

.theme-option.active {
  border-color: var(--accent);
  background-color: rgba(78, 172, 109, 0.1);
}

body.dark-mode .theme-option.active {
  background-color: rgba(78, 172, 109, 0.2);
}

.theme-icon-large {
  font-size: 2rem;
  margin-bottom: 8px;
}

.rtl-toggle {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #e9ecef;
}

body.dark-mode .rtl-toggle {
  border-bottom-color: #444;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: var(--transition);
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: var(--transition);
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--accent);
}

input:checked + .toggle-slider:before {
  transform: translateX(26px);
}

/* Card Styles */
.card-custom {
  background: var(--white);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(0,0,0,0.05);
  margin-bottom: 20px;
  transition: var(--transition);
}

body.dark-mode .card-custom {
  background: #1e1e1e;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

.tag-badge {
  background-color: #dee2e6;
  color: #212529;
  padding: 5px 10px;
  margin-right: 5px;
  border-radius: 20px;
  font-size: 12px;
  display: inline-block;
}

body.dark-mode .tag-badge {
  background-color: #333;
  color: var(--white);
}

.coin-box {
  border-right: 1px solid #dee2e6;
  padding: 0 15px;
}

body.dark-mode .coin-box {
  border-right: 1px solid #444;
}

.coin-box:last-child {
  border-right: none;
}

/* Card Stats Styles */
.card-stats {
  border: none;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card-stats:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}

.card-stats .icon {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
}

.bg-gradient-primary {
  background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
}

.bg-gradient-info {
  background: linear-gradient(135deg, #36b9cc 0%, #258391 100%);
}

.bg-gradient-warning {
  background: linear-gradient(135deg, #f6c23e 0%, #dda20a 100%);
}

.bg-gradient-success {
  background: linear-gradient(135deg, #1cc88a 0%, #13855c 100%);
}

/* Chart Card Styles */
.card-chart {
  border: none;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.card-chart .card-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  padding: 1rem 1.5rem;
}

.card-chart .card-body {
  padding: 1.5rem;
}

/* Recent Activity Table Styles */
.table-responsive {
  border-radius: 12px;
  overflow: hidden;
}

.table thead th {
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.75rem;
  letter-spacing: 0.5px;
  padding: 1rem 0.75rem;
}

.table tbody td {
  padding: 1rem 0.75rem;
  vertical-align: middle;
}

.table-hover tbody tr:hover {
  background-color: rgba(0, 0, 0, 0.02);
}

body.dark-mode .card {
  background-color: #2a2a2a;
  color: #fff;
}

body.dark-mode .card-header {
  border-bottom-color: #444;
}

body.dark-mode .table {
  color: #fff;
}

body.dark-mode .table thead th {
  background-color: #333;
  color: #fff;
}

body.dark-mode .table-hover tbody tr:hover {
  background-color: rgba(255, 255, 255, 0.02);
}

body.dark-mode .text-muted {
  color: #aaa !important;
}

/* Fullscreen styles */
body.fullscreen {
  overflow: hidden;
}

body.fullscreen .main-content {
  padding: 0;
}

body.fullscreen .header-bar {
  border-radius: 0;
  margin-bottom: 0;
}

/* Tooltip styles */
.tooltip {
  position: absolute;
  background-color: #333;
  color: white;
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 0.8rem;
  white-space: nowrap;
  z-index: 100;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s;
}

.header-icon-btn:hover .tooltip,
.user-avatar:hover .tooltip {
  opacity: 1;
}

/* Overlay for settings panel */
.settings-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1040;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
}

.settings-overlay.active {
  opacity: 1;
  visibility: visible;
}

/* Enhanced Mobile Styles */
@media (max-width: 768px) {
  body {
    background: linear-gradient(135deg, var(--primary-bg), var(--secondary-bg));
  }

  .sidebar {
    width: var(--sidebar-width);
    transform: translateX(-100%);
    background: linear-gradient(180deg, var(--primary-bg), #0a1729);
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
    transition: transform 0.4s ease-in-out;
  }

  .sidebar.show {
    transform: translateX(0);
  }

  .sidebar.collapsed {
    width: var(--sidebar-width);
    transform: translateX(-100%);
  }

  .sidebar .nav-text {
    display: inline !important;
    font-size: 1rem;
    margin-left: 10px;
    white-space: nowrap;
  }

  .sidebar h4 {
    font-size: 1.4rem;
    padding: 15px;
  }

  .sidebar .nav-link {
    padding: 14px 20px;
    font-size: 1rem;
    border-radius: 8px;
    margin: 5px 10px;
    transition: var(--transition), box-shadow 0.3s;
  }

  .sidebar .nav-link:hover {
    box-shadow: var(--glow);
    transform: scale(1.02);
  }

  .sidebar .sub-menu .nav-link {
    padding-left: 30px;
    background-color: #0a1729;
    border-left: 3px solid var(--accent);
  }

  .sidebar .sub-menu .nav-link:hover {
    background-color: #15253d;
  }

  .sidebar.collapsed .sub-menu {
    display: none;
  }

  .user-section {
    padding: 15px;
  }

  .user-section h5 {
    font-size: 1.1rem;
  }

  .user-section p {
    font-size: 0.9rem;
  }

  .logout-btn {
    padding: 10px;
    font-size: 1rem;
    border-radius: 8px;
  }

  .main-content {
    margin-left: 0;
    padding: 15px;
  }

  .header-bar {
    padding: 10px;
    border-radius: 0;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }

  .header-controls {
    flex-direction: column;
    gap: 15px;
  }

  .header-control-group {
    justify-content: center;
    gap: 15px;
  }

  .header-icon-btn {
    width: 44px;
    height: 44px;
    font-size: 1.4rem;
    border-radius: 50%;
    background-color: rgba(78, 172, 109, 0.1);
    transition: var(--transition), box-shadow 0.3s;
  }

  .header-icon-btn:hover {
    box-shadow: var(--glow);
    transform: scale(1.05);
  }

  .header-search {
    display: flex;
    max-width: 100%;
    margin: 10px 0;
    padding: 8px 15px;
    border-radius: 25px;
  }

  .search-input {
    font-size: 1rem;
    padding: 10px 15px 10px 35px;
  }

  .search-btn {
    font-size: 1.2rem;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border: 2px solid var(--accent);
    transition: var(--transition), box-shadow 0.3s;
  }

  .user-avatar:hover {
    box-shadow: var(--glow);
    transform: scale(1.05);
  }

  .notification-badge {
    width: 20px;
    height: 20px;
    font-size: 0.8rem;
    bottom: 24px;
    right: -4px;
  }

  .card-stats, .card-chart {
    border-radius: 15px;
    margin-bottom: 20px;
    animation: fadeIn 0.5s ease-in;
  }

  .card-stats:hover, .card-chart:hover {
    transform: translateY(-3px);
  }

  .card-body {
    padding: 15px;
  }

  .card-title {
    font-size: 1.1rem;
  }

  .card h2 {
    font-size: 1.6rem;
  }

  .card .small {
    font-size: 0.9rem;
  }

  .chart-container {
    height: 250px !important;
  }

  .table-responsive {
    font-size: 0.95rem;
  }

  .table th, .table td {
    padding: 12px;
    font-size: 0.95rem;
  }

  .table img {
    width: 40px;
    height: 40px;
  }

  .table .btn {
    font-size: 0.9rem;
    padding: 6px 12px;
    border-radius: 8px;
  }

  .settings-panel {
    width: 100%;
    right: -100%;
    background: linear-gradient(180deg, var(--primary-bg), #0a1729);
    animation: slideIn 0.4s ease-in-out forwards;
  }

  .settings-panel.open {
    right: 0;
  }

  .settings-section {
    padding: 15px;
  }

  .settings-section-title {
    font-size: 1.2rem;
  }

  .theme-option {
    padding: 15px;
    border-radius: 10px;
  }

  .theme-icon-large {
    font-size: 1.8rem;
  }

  .rtl-toggle span {
    font-size: 1.1rem;
  }

  .toggle-switch {
    width: 60px;
    height: 28px;
  }

  .toggle-slider {
    border-radius: 28px;
  }

  .toggle-slider:before {
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
  }

  input:checked + .toggle-slider:before {
    transform: translateX(32px);
  }

  @keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
}

@media (max-width: 480px) {
  .sidebar {
    width: 240px;
  }

  .sidebar h4 {
    font-size: 1.2rem;
  }

  .sidebar .nav-link {
    font-size: 0.95rem;
    padding: 12px 15px;
  }

  .sidebar .nav-text {
    font-size: 0.9rem;
  }

  .sidebar .sub-menu .nav-link {
    padding-left: 25px;
  }

  .user-section h5 {
    font-size: 1rem;
  }

  .user-section p {
    font-size: 0.85rem;
  }

  .logout-btn {
    font-size: 0.9rem;
    padding: 8px;
  }

  .header-icon-btn {
    width: 40px;
    height: 40px;
    font-size: 1.2rem;
  }

  .user-avatar {
    width: 36px;
    height: 36px;
  }

  .notification-badge {
    width: 18px;
    height: 18px;
    font-size: 0.7rem;
  }

  .card h2 {
    font-size: 1.4rem;
  }

  .card .small {
    font-size: 0.8rem;
  }

  .table th, .table td {
    font-size: 0.85rem;
    padding: 10px;
  }

  .table img {
    width: 35px;
    height: 35px;
  }

  .table .btn {
    font-size: 0.8rem;
    padding: 5px 10px;
  }

  .chart-container {
    height: 200px !important;
  }

  .settings-section-title {
    font-size: 1.1rem;
  }

  .theme-option {
    padding: 12px;
  }

  .theme-icon-large {
    font-size: 1.6rem;
  }

  .rtl-toggle span {
    font-size: 1rem;
  }

  .toggle-switch {
    width: 50px;
    height: 24px;
  }

  .toggle-slider:before {
    height: 16px;
    width: 16px;
  }

  input:checked + .toggle-slider:before {
    transform: translateX(26px);
  }
}
  </style>

</head>
<body>
  <!-- Sidebar Navigation -->
  <div class="sidebar d-flex flex-column" id="sidebar">
    <h4 class="text-center py-3">Admin Panel</h4>
    <nav class="nav flex-column">
      <a href="#" class="nav-link">
        <i class="bi bi-display"></i>
        <span class="nav-text">Dashboard</span>
      </a>

      <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#reportsMenu">
        <span>
          <i class="bi bi-people-fill"></i>
            <span class="nav-text">Manage Users</span>
        </span>
        <i class="bi bi-chevron-right toggle-arrow"></i>
      </a>
      <div class="collapse sub-menu" id="reportsMenu">
        <a href="{% url 'manage_members_api' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">All Members</span>
        </a>
        <a href="#" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Banned Users</span>
        </a>
      </div>

      <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#icoMenu">
        <span>
          <i class="bi bi-discord"></i>
          <span class="nav-text">Chat Monitoring</span>
        </span>
        <i class="bi bi-chevron-right toggle-arrow"></i>
      </a>
      <div class="collapse sub-menu" id="icoMenu">
        <a href="{% url 'chatprvate' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Private Messages</span>
        </a>
        <a href="{% url 'GroupMessages' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Group Chat</span>
        </a>
        <a href="{% url 'DarkMessages' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Dark Messages</span>
        </a>
      </div>

      <a href="{% url 'reportemessages' %}" class="nav-link">
        <i class="bi bi-flag-fill"></i>
        <span class="nav-text">Reported Messages</span>
      </a>
      <a href="{% url 'user_activities' %}" class="nav-link">
        <i class="bi bi-activity"></i>
        <span class="nav-text">User Activity</span>
      </a> 
      <a href="#" class="nav-link">
        <i class="bi bi-people-fill"></i>
        <span class="nav-text">Manage Rooms/Groups</span>
      </a>
      <a href="{% url 'view_notifications' %}" class="nav-link">
        <i class="bi bi-chat-dots-fill"></i>
        <span class="nav-text">Messages</span>
      </a>
      <a href="{% url 'privacydash' %}" class="nav-link">
        <i class="bi bi-lock-fill"></i>
        <span class="nav-text">Privacy</span>
      </a>
      <a href="{% url 'reportedposts' %}" class="nav-link">
        <i class="bi bi-kanban-fill"></i>
        <span class="nav-text">Manage Posts</span>
      </a>
    </nav>

    <!-- User Section -->
    <div class="user-section">
    <h5>{{ request.user.username }}</h5>
    <p>Administrator</p>
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-btn btn btn-danger">Logout</button>
    </form>
</div>


    <!-- Copyright -->
    <div class="copyright">
      <div>Chat Admin Dashboard</div>
      <div>Â© 2025 All Rights Reserved</div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- Header -->
    <div class="header-bar">
      <div class="header-controls">
        <!-- Left side controls -->
        <div class="header-control-group">
          <button class="header-icon-btn" id="toggleSidebar">
            <i class="bi bi-list"></i>
            <span class="tooltip">Toggle Sidebar</span>
          </button>
          <button class="header-icon-btn" id="messagesBtn" onclick="window.location.href='{% url 'view_notifications' %}'">
              <i class="bi bi-chat-left-dots"></i>
              <span class="tooltip">Messages</span>
          </button>
          <button class="header-icon-btn" id="mentionsBtn">
            <i class="bi bi-at"></i>
            <span class="tooltip">Mentions</span>
          </button>
          <!-- Include flatpickr CSS & JS -->
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
          <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

          <!-- Button -->
          <button class="header-icon-btn" id="calendarBtn">
            <i class="bi bi-calendar4"></i>
            <span class="tooltip">Calendar</span>
          </button>

          <!-- Popup container -->
          <div id="calendarPopup" class="calendar-popup">
            <input type="text" id="calendarInput">
          </div>

          <style>
          /* Popup styling */
          .calendar-popup {
            display: none;
            
            position: relative;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            z-index: 1000;
          }
          </style>

          <script>
          const btn = document.getElementById('calendarBtn');
          const popup = document.getElementById('calendarPopup');
          const input = document.getElementById('calendarInput');

          // Initialize flatpickr
          flatpickr(input, {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            onClose: function(selectedDates, dateStr) {
              console.log("Selected:", dateStr);
            }
          });

          // Show popup under button
          btn.addEventListener('click', (e) => {
            const rect = btn.getBoundingClientRect();
            popup.style.top = rect.bottom + window.scrollY + "px"; // below button
            popup.style.left = rect.left + window.scrollX + "px";  // align left
            popup.style.display = 'block';
            input._flatpickr.open();
            e.stopPropagation(); // prevent outside click
          });

          // Close popup if clicked outside
          window.addEventListener('click', (e) => {
            if (!popup.contains(e.target) && e.target !== btn) {
              popup.style.display = 'none';
            }
          });

          // Stop propagation inside input
          input.addEventListener('click', (e) => {
            e.stopPropagation();
          });
          </script>
        </div>

        <!-- Search bar -->
        <div class="header-search">
          <i class="bi bi-search"></i>
          <input type="text" class="search-input" id="globalSearch" placeholder="Search...">
          <button class="search-btn" id="searchButton">
            <i class="bi bi-arrow-right" style="margin-left: -20px;"></i>
          </button>
        </div>

        <!-- Right side controls -->
        <div class="header-control-group">
          <button class="header-icon-btn" id="fullscreenBtn">
            <i class="bi bi-fullscreen"></i>
            <span class="tooltip">Fullscreen</span>
          </button>
          <button class="header-icon-btn notification-btn" id="notificationsBtn" onclick="window.location.href='{% url 'view_notifications' %}'">
              <i class="bi bi-bell"></i>
              <span class="notification-badge" id="notificationCount">0</span>
              <span class="tooltip">Notifications</span>
          </button>

          <script>
          // Function to load notification count
          function loadNotificationCount() {
              fetch('/get_notification_count/')
                  .then(response => {
                      if (!response.ok) {
                          throw new Error('Network response was not ok');
                      }
                      return response.json();
                  })
                  .then(data => {
                      updateNotificationCount(data.count);
                  })
                  .catch(error => {
                      console.error('Error fetching notification count:', error);
                  });
          }
          
          // Function to update notification badge count
          function updateNotificationCount(count) {
              const badge = document.getElementById('notificationCount');
              if (badge) {
                  badge.textContent = count;
                  
                  // Show/hide badge based on count
                  if (count > 0) {
                      badge.style.display = 'flex';
                  } else {
                      badge.style.display = 'none';
                  }
              }
          }
          
          // Load notification count when page loads
          document.addEventListener('DOMContentLoaded', function() {
              loadNotificationCount();
              
              // Optional: Refresh count every 60 seconds
              setInterval(loadNotificationCount, 60000);
          });
          </script>
          
          <script>
          // Function to load notification count
          function loadNotificationCount() {
              fetch('/get_notification_count/')
                  .then(response => {
                      if (!response.ok) {
                          throw new Error('Network response was not ok');
                      }
                      return response.json();
                  })
                  .then(data => {
                      updateNotificationCount(data.count);
                  })
                  .catch(error => {
                      console.error('Error fetching notification count:', error);
                  });
          }
          
          // Function to update notification badge count
          function updateNotificationCount(count) {
              const badge = document.getElementById('notificationCount');
              if (badge) {
                  badge.textContent = count;
                  
                  // Show/hide badge based on count
                  if (count > 0) {
                      badge.style.display = 'flex';
                  } else {
                      badge.style.display = 'none';
                  }
              }
          }
          
          // Load notification count when page loads
          document.addEventListener('DOMContentLoaded', function() {
              loadNotificationCount();
              
              // Optional: Refresh count every 60 seconds
              setInterval(loadNotificationCount, 60000);
          });
          </script>
          <div class="user-avatar" id="userProfile">
            <img src="{% static 'DASHBOARD/pics/me.jpg' %}" alt="User Avatar">
            <span class="tooltip">Profile</span>
          </div>
          <button class="header-icon-btn" id="settingsBtn">
            <i class="bi bi-gear"></i>
            <span class="tooltip">Settings</span>
          </button>
        </div>
      </div>
    </div>

  {% block content %}

    <!-- Dashboard Content -->

    <div class="container-fluid p-4">
  <h1 class="mt-4 mb-4">Chat Dashboard Overview</h1>

  <!-- Stats Cards Row -->
  <div class="row g-4 mb-4">
    <!-- Total Users Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Total Users</h6>
              <h2 class="mb-0" id="totalUsersCount">{{ total_users }}</h2>
              <span class="text-success fw-bold small">
                <i class="bi bi-arrow-up"></i> 12.5%
              </span>
              <span class="text-muted small ms-2">vs last month</span>
            </div>
            <div class="icon icon-shape bg-gradient-primary text-white rounded-circle shadow">
              <i class="bi bi-people-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Active Conversations Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Active Chats</h6>
              <h2 class="mb-0">20</h2>
              <span class="text-success fw-bold small">
                <i class="bi bi-arrow-up"></i> 2%
              </span>
              <span class="text-muted small ms-2">vs last month</span>
            </div>
            <div class="icon icon-shape bg-gradient-info text-white rounded-circle shadow">
              <i class="bi bi-chat-dots-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Messages Today Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Messages Today</h6>
              <h2 class="mb-0">5</h2>
              <span class="text-danger fw-bold small">
                <i class="bi bi-arrow-down"></i> 3%
              </span>
              <span class="text-muted small ms-2">vs yesterday</span>
            </div>
            <div class="icon icon-shape bg-gradient-warning text-white rounded-circle shadow">
              <i class="bi bi-envelope-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Avg Response Time Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Avg Response</h6>
              <h2 class="mb-0">1.8 <small class="fs-6">min</small></h2>
              <span class="text-success fw-bold small">
                <i class="bi bi-arrow-down"></i> 15.7%
              </span>
              <span class="text-muted small ms-2">improvement</span>
            </div>
            <div class="icon icon-shape bg-gradient-success text-white rounded-circle shadow">
              <i class="bi bi-stopwatch-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row g-4">
<!-- User Activity Chart -->
<div class="col-lg-6">
  <div class="card card-chart">
    <div class="card-header bg-transparent">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">User Activity</h6>
        <div class="dropdown">
          <button class="btn btn-sm btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown">
            This Month
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Today</a></li>
            <li><a class="dropdown-item" href="#">This Week</a></li>
            <li><a class="dropdown-item" href="#">This Month</a></li>
            <li><a class="dropdown-item" href="#">This Year</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="chart-container" style="height: 300px;">
        <canvas id="userActivityChart" style="height: 300px;"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Make sure Django context variables are JSON encoded
    // Use JSON-parsed values from script tags to avoid redeclaration errors

    const ctx = document.getElementById('userActivityChart').getContext('2d');
    const userActivityChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: JSON.parse(document.getElementById('labels-json').textContent),
            datasets: [{
                label: 'User Activity',
                data: JSON.parse(document.getElementById('data-json').textContent),
                borderColor: 'rgba(78, 115, 223, 1)',
                backgroundColor: 'rgba(78, 115, 223, 0.1)',
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: 'rgba(78, 115, 223, 1)',
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
            },
            scales: {
                y: {
                    beginAtZero: true,
                    stepSize: 1
                },
                x: {
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        }
    });
</script>

    <!-- Conversation Metrics Chart -->
    <div class="col-lg-6">
      <div class="card card-chart">
        <div class="card-header bg-transparent">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Conversation Metrics</h6>
            <div class="dropdown">
              <button class="btn btn-sm btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown">
                By Day
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">By Hour</a></li>
                <li><a class="dropdown-item" href="#">By Day</a></li>
                <li><a class="dropdown-item" href="#">By Week</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-container" style="height: 300px;">
            <!-- Chart will be inserted here -->
            <div class="d-flex justify-content-center align-items-center h-100">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity Row -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">Recent Chat Activity</h6>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-items-center mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-4">User</th>
                  <th>Status</th>
                  <th>Last Message</th>
                  <th>Time</th>
                  <th>Agent</th>
                  <th class="text-end pe-4">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="ps-4">
                    <div class="d-flex align-items-center">
                      <!---<img src="D:\Python\newcode\pics\me.jpg" class="rounded-circle me-2" alt="user">--->
                      <div>
                        <h6 class="mb-0">Sarah Johnson</h6>
                        <small class="text-muted">sarah@example.com</small>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge bg-success">Active</span></td>
                  <td>How do I reset my password?</td>
                  <td>2 min ago</td>
                  <td>Alex Chen</td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-primary">View</button>
                  </td>
                </tr>
                <tr>
                  <td class="ps-4">
                    <div class="d-flex align-items-center">
                      <!---<img src="D:\Python\newcode\pics\me.jpg" class="rounded-circle me-2" alt="user">--->
                      <div>
                        <h6 class="mb-0">Michael Brown</h6>
                        <small class="text-muted">michael@example.com</small>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge bg-warning">Pending</span></td>
                  <td>I have a question about my subscription</td>
                  <td>15 min ago</td>
                  <td>Unassigned</td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-primary">Assign</button>
                  </td>
                </tr>
                <tr>
                  <td class="ps-4">
                    <div class="d-flex align-items-center">
                      <!---<img src="D:\Python\newcode\pics\me.jpg" class="rounded-circle me-2" alt="user">--->
                      <div>
                        <h6 class="mb-0">Emma Wilson</h6>
                        <small class="text-muted">emma@example.com</small>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge bg-secondary">Closed</span></td>
                  <td>Thank you for your help!</td>
                  <td>1 hour ago</td>
                  <td>Jamie Lee</td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-primary">Reopen</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

  <!-- Settings Panel Overlay -->
  <div class="settings-overlay" id="settingsOverlay"></div>

  <!-- Settings Panel -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h3 class="settings-title">Settings</h3>
      <button class="close-settings" id="closeSettings">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="settings-section">
      <h4 class="settings-section-title">Appearance</h4>
      <div class="theme-options">
        <div class="theme-option light-theme" id="lightTheme">
          <i class="bi bi-sun-fill theme-icon-large"></i>
          <div>Light</div>
        </div>
        <div class="theme-option dark-theme" id="darkTheme">
          <i class="bi bi-moon-stars-fill theme-icon-large"></i>
          <div>Dark</div>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <h4 class="settings-section-title">Layout</h4>
      <div class="rtl-toggle">
        <span>Right-to-Left (RTL)</span>
        <label class="toggle-switch">
          <input type="checkbox" id="rtlToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>

    <div class="settings-section">
      <h4 class="settings-section-title">Sidebar</h4>
      <div class="rtl-toggle">
        <span>Toggle Sidebar</span>
        <label class="toggle-switch">
          <input type="checkbox" id="sidebarToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="rtl-toggle">
        <span>Right Sidebar Slide</span>
        <label class="toggle-switch">
          <input type="checkbox" id="rightSidebarToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
  </div>

  <!----bootstrap js --->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!---- JS for mine 
  <script src="D:\Python\newcode\JS\index.js"></script>
  ---->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const body = document.body;
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      const toggleSidebarBtn = document.getElementById('toggleSidebar');
      const fullscreenBtn = document.getElementById('fullscreenBtn');
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsPanel = document.getElementById('settingsPanel');
      const settingsOverlay = document.getElementById('settingsOverlay');
      const closeSettings = document.getElementById('closeSettings');
      const lightTheme = document.getElementById('lightTheme');
      const darkTheme = document.getElementById('darkTheme');
      const rtlToggle = document.getElementById('rtlToggle');
      const sidebarToggle = document.getElementById('sidebarToggle');
      const rightSidebarToggle = document.getElementById('rightSidebarToggle');
      const logoutBtn = document.querySelector('.logout-btn');

      // Initialize Bootstrap Collapse for dropdowns
      const collapseElements = document.querySelectorAll('[data-bs-toggle="collapse"]');
      collapseElements.forEach(el => {
        el.addEventListener('click', function() {
          const target = document.querySelector(this.getAttribute('href'));
          const isExpanded = this.getAttribute('aria-expanded') === 'true';
          this.setAttribute('aria-expanded', !isExpanded);
          
          // Toggle chevron icon
          const arrow = this.querySelector('.toggle-arrow');
          if (arrow) {
            arrow.classList.toggle('bi-chevron-right');
            arrow.classList.toggle('bi-chevron-down');
          }
        });
      });

      // Toggle sidebar
      toggleSidebarBtn.addEventListener('click', function() {
        sidebar.classList.toggle('collapsed');
        localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        sidebarToggle.checked = sidebar.classList.contains('collapsed');
      });

      // Fullscreen toggle
      fullscreenBtn.addEventListener('click', function() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(err => {
            console.error(`Error attempting to enable fullscreen: ${err.message}`);
          });
          body.classList.add('fullscreen');
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
            body.classList.remove('fullscreen');
          }
        }
      });

      // Open settings panel
      settingsBtn.addEventListener('click', function() {
        settingsPanel.classList.add('open');
        settingsOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      });

      // Close settings panel
      closeSettings.addEventListener('click', closeSettingsPanel);
      settingsOverlay.addEventListener('click', closeSettingsPanel);

      function closeSettingsPanel() {
        settingsPanel.classList.remove('open');
        settingsOverlay.classList.remove('active');
        document.body.style.overflow = '';
      }

      // Theme toggle
      lightTheme.addEventListener('click', function() {
        body.classList.remove('dark-mode');
        localStorage.setItem('darkMode', 'false');
        updateThemeSelection();
      });

      darkTheme.addEventListener('click', function() {
        body.classList.add('dark-mode');
        localStorage.setItem('darkMode', 'true');
        updateThemeSelection();
      });

      function updateThemeSelection() {
        const isDarkMode = body.classList.contains('dark-mode');
        lightTheme.classList.toggle('active', !isDarkMode);
        darkTheme.classList.toggle('active', isDarkMode);
      }

      // RTL toggle
      rtlToggle.addEventListener('change', function() {
        if (this.checked) {
          document.documentElement.dir = 'rtl';
        } else {
          document.documentElement.dir = 'ltr';
        }
        localStorage.setItem('rtlMode', this.checked);
      });

      // Sidebar toggle in settings
      sidebarToggle.addEventListener('change', function() {
        sidebar.classList.toggle('collapsed', this.checked);
        localStorage.setItem('sidebarCollapsed', this.checked);
      });

      // Right sidebar toggle
      rightSidebarToggle.addEventListener('change', function() {
        // Add your right sidebar toggle logic here
        console.log('Right sidebar toggle:', this.checked);
        localStorage.setItem('rightSidebar', this.checked);
      });

      // Logout button
      logoutBtn.addEventListener('click', function() {
        // Add your logout logic here
        alert('Logging out...');
      });

      // Initialize from localStorage
      if (localStorage.getItem('sidebarCollapsed') === 'true') {
        sidebar.classList.add('collapsed');
        sidebarToggle.checked = true;
      }

      if (localStorage.getItem('darkMode') === 'true') {
        body.classList.add('dark-mode');
        darkTheme.classList.add('active');
      } else {
        lightTheme.classList.add('active');
      }

      if (localStorage.getItem('rtlMode') === 'true') {
        rtlToggle.checked = true;
        document.documentElement.dir = 'rtl';
      }

      if (localStorage.getItem('rightSidebar') === 'true') {
        rightSidebarToggle.checked = true;
      }

      // Mobile menu toggle (for small screens)
      function checkScreenSize() {
        if (window.innerWidth <= 768) {
          sidebar.classList.add('collapsed');
        } else {
          sidebar.classList.remove('collapsed');
        }
      }

      // Initial check
      checkScreenSize();
      
      // Check on resize
      window.addEventListener('resize', checkScreenSize);

      // Tooltip functionality
      const tooltipElements = document.querySelectorAll('.header-icon-btn, .user-avatar');
      tooltipElements.forEach(el => {
        const tooltip = el.querySelector('.tooltip');
        if (tooltip) {
          el.addEventListener('mouseenter', () => {
            tooltip.style.opacity = '1';
          });
          el.addEventListener('mouseleave', () => {
            tooltip.style.opacity = '0';
          });
        }
      });
    });

  
    // Enhanced Search Functionality
    document.addEventListener('DOMContentLoaded', function() {
      const globalSearch = document.getElementById('globalSearch');
      const searchButton = document.getElementById('searchButton');
      let currentSearchTerm = '';
      
      // Create no results message element
      const noResultsMsg = document.createElement('div');
      noResultsMsg.className = 'search-no-results';
      noResultsMsg.textContent = 'No results found';
      document.querySelector('.dashboard-content').appendChild(noResultsMsg);
      
      // Function to perform search
      function performSearch(searchTerm) {
        currentSearchTerm = searchTerm.trim().toLowerCase();
        
        if (!currentSearchTerm) {
          clearSearchHighlights();
          noResultsMsg.style.display = 'none';
          return;
        }
        
        // Get all text nodes in the main content area
        const mainContent = document.querySelector('.main-content');
        const walker = document.createTreeWalker(
          mainContent,
          NodeFilter.SHOW_TEXT,
          null,
          false
        );
        
        let foundResults = false;
        const textNodes = [];
        let node;
        
        while (node = walker.nextNode()) {
          if (node.parentNode.classList && 
              (node.parentNode.classList.contains('search-highlight') || 
               node.parentNode.classList.contains('search-no-results'))) {
            continue;
          }
          textNodes.push(node);
        }
        
        clearSearchHighlights();
        
        textNodes.forEach(textNode => {
          const content = textNode.nodeValue;
          const parent = textNode.parentNode;
          
          if (content.toLowerCase().includes(currentSearchTerm)) {
            foundResults = true;
            const regex = new RegExp(currentSearchTerm, 'gi');
            const newContent = content.replace(regex, match => {
              return `<span class="search-highlight">${match}</span>`;
            });
            
            if (parent.innerHTML) {
              parent.innerHTML = parent.innerHTML.replace(
                content, 
                newContent
              );
            } else {
              const span = document.createElement('span');
              span.innerHTML = newContent;
              parent.replaceChild(span, textNode);
            }
          }
        });
        
        noResultsMsg.style.display = foundResults ? 'none' : 'block';
      }
      
      // Clear search highlights
      function clearSearchHighlights() {
        const highlights = document.querySelectorAll('.search-highlight');
        highlights.forEach(highlight => {
          const parent = highlight.parentNode;
          parent.textContent = parent.textContent;
          parent.normalize();
        });
      }
      
      // Event listeners for search
      globalSearch.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          performSearch(this.value);
        } else if (this.value.trim() === '') {
          clearSearchHighlights();
          noResultsMsg.style.display = 'none';
        }
      });
      
      searchButton.addEventListener('click', function() {
        performSearch(globalSearch.value);
      });
      
      // Add this to your existing dark mode toggle
      function updateSearchForDarkMode(isDarkMode) {
        const highlights = document.querySelectorAll('.search-highlight');
        highlights.forEach(highlight => {
          highlight.style.color = isDarkMode ? '#000' : '#000';
          highlight.style.backgroundColor = isDarkMode ? '#FFEB3B' : '#FFEB3B';
        });
      }
      
      // Modify your existing theme toggle to include search updates
      lightTheme.addEventListener('click', function() {
        body.classList.remove('dark-mode');
        localStorage.setItem('darkMode', 'false');
        updateThemeSelection();
        updateSearchForDarkMode(false);
      });
      
      darkTheme.addEventListener('click', function() {
        body.classList.add('dark-mode');
        localStorage.setItem('darkMode', 'true');
        updateThemeSelection();
        updateSearchForDarkMode(true);
      });
    });
  </script>
    
  <!-- JS -->
  <script src="{% static 'DASHBOARD/JS/indexx.js' %}"></script>
</body>
</html>
